openapi: 3.0.3
info:
  title: Represent App - Address Lookup API
  description: |
    REST API for looking up political representatives by street address.
    
    ## Overview
    This API enables citizens to find their elected representatives (federal, state, and local)
    by providing a residential street address. The system integrates with Google Civic Information API
    to resolve addresses to political divisions, then retrieves representative data from OpenStates.org API.
    
    ## Key Features
    - Address-based representative lookup
    - Federal and state representative coverage (50 US states)
    - Government level categorization (federal, state, local)
    - Partial results with clear warnings for missing data
    - Secure API key management via AWS Parameter Store
    
    ## Rate Limits
    - Google Civic API: 25,000 requests/day
    - OpenStates API: 5,000 requests/day
    - No application-level rate limiting in MVP
    
    ## Performance
    - Target response time: <3 seconds (p95)
    - No persistent caching in MVP (direct API calls)
  version: 1.0.0
  contact:
    name: Represent App Support
    email: support@representapp.example.com
  license:
    name: MIT

servers:
  - url: https://api.representapp.example.com
    description: Production API
  - url: https://dev-api.representapp.example.com
    description: Development API

tags:
  - name: Representatives
    description: Representative lookup operations

paths:
  /representatives:
    get:
      tags:
        - Representatives
      summary: Look up representatives by address
      description: |
        Returns all federal and state representatives for a given US street address.
        
        **Process Flow**:
        1. Validates address parameter
        2. Calls Google Civic API to resolve address to OCD-IDs
        3. Queries OpenStates API for representatives in each division
        4. Aggregates and deduplicates results by representative ID
        5. Categorizes by government level (federal, state, local)
        6. Returns representatives with metadata and warnings
        
        **Coverage Notes**:
        - Federal representatives: US Senators, US House members (if applicable)
        - State representatives: Governor, State Senators, State House members
        - Local representatives: Limited coverage (OpenStates gap)
      operationId: lookupRepresentatives
      parameters:
        - name: address
          in: query
          required: true
          description: |
            Full US residential street address including street number, street name, city, state, and ZIP code.
            
            **Examples**:
            - `1600 Pennsylvania Ave NW, Washington, DC 20500`
            - `123 Main Street, Springfield, IL 62701`
            - `456 Oak Ave, Apt 5, Seattle, WA 98101`
            
            **Validation**:
            - Must be non-empty after trimming whitespace
            - Maximum length: 500 characters
            - Special characters sanitized before API calls
          schema:
            type: string
            minLength: 1
            maxLength: 500
            example: "1600 Pennsylvania Ave NW, Washington, DC 20500"
      responses:
        '200':
          description: |
            Representatives found successfully. May include partial results with warnings
            if some divisions have no data (especially local officials).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RepresentativesResponse'
              examples:
                fullResults:
                  summary: Full results (federal + state)
                  value:
                    representatives:
                      - id: "ocd-person/a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                        name: "Jane Smith"
                        office: "US Senator"
                        party: "Democratic"
                        email: "senator.smith@senate.gov"
                        phone: "202-555-0100"
                        address: "123 Senate Office Building, Washington, DC 20510"
                        website: "https://smith.senate.gov"
                        photo_url: "https://openstates.org/static/images/smith.jpg"
                        government_level: "federal"
                        jurisdiction: "United States"
                      - id: "ocd-person/b2c3d4e5-f6g7-8901-bcde-fg2345678901"
                        name: "John Doe"
                        office: "State Senator - District 12"
                        party: "Republican"
                        email: "john.doe@statehouse.gov"
                        phone: "916-555-0200"
                        address: "State Capitol, Sacramento, CA 95814"
                        website: "https://doe.statehouse.gov"
                        photo_url: null
                        government_level: "state"
                        jurisdiction: "California State Senate District 12"
                    metadata:
                      address: "1600 Pennsylvania Ave NW, Washington, DC 20500"
                      government_levels: ["federal", "state"]
                partialResults:
                  summary: Partial results with warnings
                  value:
                    representatives:
                      - id: "ocd-person/a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                        name: "Jane Smith"
                        office: "US Senator"
                        party: "Democratic"
                        email: "senator.smith@senate.gov"
                        phone: "202-555-0100"
                        address: "123 Senate Office Building, Washington, DC 20510"
                        website: "https://smith.senate.gov"
                        photo_url: "https://openstates.org/static/images/smith.jpg"
                        government_level: "federal"
                        jurisdiction: "United States"
                    metadata:
                      address: "123 Small Town Road, Ruralville, WY 82001"
                      government_levels: ["federal", "state"]
                    warnings:
                      - "No data available for: ocd-division/country:us/state:wy/county:albany"
        '400':
          description: Bad request - invalid or missing address parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missingParameter:
                  summary: Missing address parameter
                  value:
                    error:
                      code: "MISSING_PARAMETER"
                      message: "Missing required parameter: address"
                      details: "The 'address' query parameter must be provided"
                invalidAddress:
                  summary: Invalid address format
                  value:
                    error:
                      code: "INVALID_ADDRESS"
                      message: "Address exceeds maximum length of 500 characters"
                      details: "Provided address was 612 characters long"
        '404':
          description: Address not found - Google Civic API could not resolve the address
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error:
                  code: "ADDRESS_NOT_FOUND"
                  message: "Unable to find political divisions for the provided address"
                  details: "Google Civic API returned zero divisions for address: '123 Nonexistent St'"
        '500':
          description: Internal server error - unexpected failure
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error:
                  code: "INTERNAL_ERROR"
                  message: "An unexpected error occurred while processing your request"
                  details: "NoneType object has no attribute 'get'"
        '503':
          description: Service unavailable - external API failure or rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                externalServiceError:
                  summary: External API down
                  value:
                    error:
                      code: "EXTERNAL_SERVICE_ERROR"
                      message: "Google Civic API is currently unavailable"
                      details: "Connection timeout after 10 seconds"
                rateLimitExceeded:
                  summary: Rate limit reached
                  value:
                    error:
                      code: "RATE_LIMIT_EXCEEDED"
                      message: "Representative lookup service temporarily unavailable due to rate limits"
                      details: "OpenStates API rate limit exceeded. Please try again later."

components:
  schemas:
    Representative:
      type: object
      required:
        - id
        - name
        - office
        - government_level
        - jurisdiction
      properties:
        id:
          type: string
          description: Unique OpenStates person identifier (used for deduplication)
          example: "ocd-person/a1b2c3d4-e5f6-7890-abcd-ef1234567890"
        name:
          type: string
          description: Full legal name of the representative
          minLength: 1
          maxLength: 200
          example: "Jane Smith"
        office:
          type: string
          description: Official title or position held
          minLength: 1
          maxLength: 100
          example: "US Senator"
        party:
          type: string
          nullable: true
          description: Political party affiliation (null for non-partisan offices)
          enum: [Democratic, Republican, Independent, Libertarian, Green, null]
          example: "Democratic"
        email:
          type: string
          nullable: true
          description: Official email address(es); semicolon-separated if multiple
          format: email
          example: "senator.smith@senate.gov"
        phone:
          type: string
          nullable: true
          description: Office phone number in XXX-XXX-XXXX format
          pattern: '^\d{3}-\d{3}-\d{4}$'
          example: "202-555-0100"
        address:
          type: string
          nullable: true
          description: Office mailing address
          maxLength: 500
          example: "123 Senate Office Building, Washington, DC 20510"
        website:
          type: string
          nullable: true
          description: Official website URL
          format: uri
          example: "https://smith.senate.gov"
        photo_url:
          type: string
          nullable: true
          description: Photo URL from OpenStates (not validated; may be broken)
          format: uri
          example: "https://openstates.org/static/images/smith.jpg"
        government_level:
          type: string
          description: Categorization by government level for UI grouping
          enum: [federal, state, local]
          example: "federal"
        jurisdiction:
          type: string
          description: Human-readable jurisdiction or district represented
          example: "United States"
    
    RepresentativesResponse:
      type: object
      required:
        - representatives
        - metadata
      properties:
        representatives:
          type: array
          description: |
            List of representatives for the provided address. Deduplicated by OpenStates ID.
            May be empty array if no representatives found.
          items:
            $ref: '#/components/schemas/Representative'
        metadata:
          type: object
          required:
            - address
            - government_levels
          properties:
            address:
              type: string
              description: Echoes the input address for user confirmation
              example: "1600 Pennsylvania Ave NW, Washington, DC 20500"
            government_levels:
              type: array
              description: Government levels included in response
              items:
                type: string
                enum: [federal, state, local]
              example: ["federal", "state"]
            response_time_ms:
              type: integer
              description: Optional end-to-end processing time in milliseconds
              example: 2456
        warnings:
          type: array
          description: |
            Optional array of warnings about missing data or coverage gaps.
            Only present when some divisions returned no representative data.
          items:
            type: string
            example: "No data available for: ocd-division/country:us/state:ca/county:alameda"
    
    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          type: object
          required:
            - code
            - message
          properties:
            code:
              type: string
              description: Machine-readable error code in UPPERCASE_SNAKE_CASE
              enum:
                - MISSING_PARAMETER
                - INVALID_ADDRESS
                - ADDRESS_NOT_FOUND
                - EXTERNAL_SERVICE_ERROR
                - RATE_LIMIT_EXCEEDED
                - INTERNAL_ERROR
              example: "ADDRESS_NOT_FOUND"
            message:
              type: string
              description: Human-readable error message suitable for display
              example: "Unable to find political divisions for the provided address"
            details:
              type: string
              nullable: true
              description: Optional additional context for debugging
              example: "Google Civic API returned zero divisions for address: '123 Fake St'"

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: |
        API key for authentication (not implemented in MVP).
        Reserved for future use when client authentication is added.

security: []  # No authentication required in MVP
